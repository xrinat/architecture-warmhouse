@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml
'LAYOUT_WITH_LEGEND()

title C4: Диаграмма компонентов — Сервис пользователей и домов

Person(Пользователь, "Пользователь", "Владелец дома, использует веб или мобильное приложение")
System_Ext(API_шлюз, "API-шлюз / Приложение", "Посредник между клиентом и микросервисами экосистемы")

Container_Boundary(Сервис_пользователей_и_домов, "Сервис пользователей и домов") {
  
  Component(API_пользователей, "API пользователей и домов", "REST / gRPC", "Предоставляет интерфейс для управления пользователями и домами")
  
  Component(Ядро_пользователей, "Ядро пользователей и домов", "Бизнес-логика", "Обрабатывает запросы: регистрация, обновление профиля, добавление домов, привязка устройств")
  
  Component(Репозиторий_пользователей, "Репозиторий пользователей", "PostgreSQL / ORM", "Хранит таблицы Пользователь и Дом, а также связи между ними")
  
  Component(Модуль_аутентификации, "Модуль аутентификации и ролей", "JWT / OAuth2", "Реализует вход, токены, роли и права доступа")
  
  Component(Публикатор_событий, "Публикатор событий пользователей", "Message Broker (Kafka/NATS)", "Публикует события (Создан пользователь, Добавлен дом) для других сервисов")
  
  Component(Логгер_аудита, "Логгер аудита", "Фоновый процесс / очередь", "Логирует изменения профилей и действий пользователей для EventLog")
}

Rel(Пользователь, API_шлюз, "Выполняет действия с профилем и домами через")
Rel(API_шлюз, API_пользователей, "Отправляет REST/gRPC запросы")
Rel(API_пользователей, Ядро_пользователей, "Вызывает бизнес-логику")
Rel(Ядро_пользователей, Репозиторий_пользователей, "Читает и изменяет данные")
Rel(Ядро_пользователей, Модуль_аутентификации, "Проверяет права доступа")
Rel(Ядро_пользователей, Публикатор_событий, "Публикует события (Пользователь создан, Дом добавлен)")
Rel(Ядро_пользователей, Логгер_аудита, "Передаёт данные об изменениях для журнала событий")

@enduml
