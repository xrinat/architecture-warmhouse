@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title C4: Диаграмма компонентов — Сервис управления устройствами

Person(Пользователь, "Пользователь", "Владелец дома, управляет устройствами через приложение")
System_Ext(API_шлюз, "API-шлюз / Приложение", "Посредник между клиентом и микросервисами экосистемы")

Container_Boundary(Сервис_управления_устройствами, "Сервис управления устройствами") {
  
  Component(API_устройств, "API устройств", "REST / gRPC", "Принимает запросы от API-шлюза и других сервисов")
  
  Component(Ядро_устройств, "Ядро управления устройствами", "Бизнес-логика", "Реализует операции с устройствами: регистрация, обновление статуса, проверка состояния")
  
  Component(Репозиторий_устройств, "Репозиторий устройств", "PostgreSQL / ORM", "Хранит таблицы Device, DeviceType и DeviceRegistration")
  
  Component(Модуль_регистрации, "Модуль регистрации устройств", "Сервисный модуль", "Обрабатывает регистрацию и аутентификацию устройств через AuthKey")
  
  Component(Публикатор_событий, "Публикатор событий устройств", "Message Broker (Kafka/NATS)", "Публикует события о смене состояния устройств для других сервисов")
  
  Component(Монитор_состояния, "Монитор состояния устройств", "Фоновый процесс / Scheduler", "Проверяет активность устройств, обновляет их статус (онлайн/оффлайн)")
}

Rel(Пользователь, API_шлюз, "Управляет устройствами через")
Rel(API_шлюз, API_устройств, "Отправляет REST/gRPC запросы")
Rel(API_устройств, Ядро_устройств, "Вызывает бизнес-логику")
Rel(Ядро_устройств, Репозиторий_устройств, "Читает и изменяет данные")
Rel(Ядро_устройств, Модуль_регистрации, "Вызывает при регистрации устройств")
Rel(Ядро_устройств, Публикатор_событий, "Публикует события об изменениях устройств")
Rel(Монитор_состояния, Репозиторий_устройств, "Проверяет статусы устройств")
Rel(Монитор_состояния, Публикатор_событий, "Отправляет уведомления о смене состояния")

@enduml
